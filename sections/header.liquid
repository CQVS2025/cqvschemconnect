{%- liquid
  assign enable_sticky = section.settings.enable_sticky
-%}

<header
  class="header{% if enable_sticky %} header--sticky{% endif %}"
  data-section-id="{{ section.id }}"
  data-section-type="header"
>
  <div class="header__container container">
    {%- comment -%} Logo {%- endcomment -%}
    <a href="/" class="header__logo" aria-label="{{ 'general.accessibility.home' | t }}">
      {%- if section.settings.logo_image != blank -%}
        <img
          src="{{ section.settings.logo_image | image_url: width: 200 }}"
          alt="{{ shop.name }}"
          width="200"
          height="50"
          loading="eager"
          class="header__logo-image"
        >
      {%- else -%}
        <span class="header__logo-text">
          <span class="header__logo-brand">CQVS</span>
          <span class="header__logo-accent">{{ section.settings.logo_text }}</span>
        </span>
      {%- endif -%}
    </a>

    {%- comment -%} Desktop Navigation {%- endcomment -%}
    <nav class="header__nav" aria-label="{{ 'sections.header.navigation' | t }}">
      <ul class="header__nav-list" role="list">
        {%- for block in section.blocks -%}
          {%- if block.type == 'nav_link' -%}
            <li class="header__nav-item" {{ block.shopify_attributes }}>
              <a href="{{ block.settings.url }}" class="header__nav-link">
                {{ block.settings.label }}
              </a>
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </nav>

    {%- comment -%} Header Actions {%- endcomment -%}
    <div class="header__actions">
      {%- comment -%} Cart Icon {%- endcomment -%}
      <a href="{{ routes.cart_url }}" class="header__cart" aria-label="{{ 'sections.header.cart' | t }}">
        <svg class="header__cart-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        {%- if cart.item_count > 0 -%}
          <span class="header__cart-count" aria-label="{{ 'sections.header.cart_count' | t: count: cart.item_count }}">
            {{ cart.item_count }}
          </span>
        {%- endif -%}
      </a>

      {%- comment -%} CTA Button {%- endcomment -%}
      {%- if section.settings.cta_text != blank -%}
        <a href="{{ section.settings.cta_link }}" class="header__cta button button--primary">
          {{ section.settings.cta_text }}
        </a>
      {%- endif -%}

      {%- comment -%} Mobile Menu Toggle {%- endcomment -%}
      <button
        class="header__menu-toggle"
        aria-label="{{ 'sections.header.menu_toggle' | t }}"
        aria-expanded="false"
        aria-controls="mobile-drawer-{{ section.id }}"
        data-menu-toggle
      >
        <svg class="header__hamburger-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>
  </div>

  {%- comment -%} Mobile Drawer {%- endcomment -%}
  <div
    id="mobile-drawer-{{ section.id }}"
    class="header__drawer"
    data-mobile-drawer
    aria-hidden="true"
  >
    <div class="header__drawer-overlay" data-drawer-overlay></div>
    <div class="header__drawer-content">
      <div class="header__drawer-header">
        <a href="/" class="header__logo" aria-label="{{ 'general.accessibility.home' | t }}">
          {%- if section.settings.logo_image != blank -%}
            <img
              src="{{ section.settings.logo_image | image_url: width: 200 }}"
              alt="{{ shop.name }}"
              width="200"
              height="50"
              loading="lazy"
              class="header__logo-image"
            >
          {%- else -%}
            <span class="header__logo-text">
              <span class="header__logo-brand">CQVS</span>
              <span class="header__logo-accent">{{ section.settings.logo_text }}</span>
            </span>
          {%- endif -%}
        </a>
        <button
          class="header__drawer-close"
          aria-label="{{ 'sections.header.close_menu' | t }}"
          data-drawer-close
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <nav class="header__drawer-nav" aria-label="{{ 'sections.header.mobile_navigation' | t }}">
        <ul class="header__drawer-nav-list" role="list">
          {%- for block in section.blocks -%}
            {%- if block.type == 'nav_link' -%}
              <li class="header__drawer-nav-item" {{ block.shopify_attributes }}>
                <a href="{{ block.settings.url }}" class="header__drawer-nav-link">
                  {{ block.settings.label }}
                </a>
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
      </nav>

      {%- if section.settings.cta_text != blank -%}
        <a href="{{ section.settings.cta_link }}" class="header__drawer-cta button button--primary">
          {{ section.settings.cta_text }}
        </a>
      {%- endif -%}
    </div>
  </div>
</header>

<style>
  .header {
    background-color: var(--color-bg-dark, #0a0a0a);
    border-bottom: 1px solid var(--color-border, rgba(255, 255, 255, 0.1));
    padding: 1rem 0;
    z-index: 1000;
    width: 100%;
    transition: transform 0.3s ease;
  }

  .header--sticky {
    position: sticky;
    top: 0;
  }

  .header__container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: var(--page-width, 1200px);
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .header__logo {
    text-decoration: none;
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .header__logo-image {
    height: 40px;
    width: auto;
    object-fit: contain;
  }

  .header__logo-text {
    font-size: 1.5rem;
    line-height: 1;
  }

  .header__logo-brand {
    font-weight: 700;
    color: #ffffff;
  }

  .header__logo-accent {
    color: var(--color-accent, #00d4aa);
    margin-left: 0.25rem;
  }

  .header__nav {
    display: none;
  }

  @media (min-width: 768px) {
    .header__nav {
      display: flex;
      align-items: center;
    }
  }

  .header__nav-list {
    display: flex;
    align-items: center;
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__nav-link {
    color: var(--color-text-muted, #b0b0b0);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: color 0.2s ease;
    white-space: nowrap;
  }

  .header__nav-link:hover {
    color: #ffffff;
  }

  .header__actions {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .header__cart {
    position: relative;
    color: #ffffff;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    transition: color 0.2s ease;
  }

  .header__cart:hover {
    color: var(--color-accent, #00d4aa);
  }

  .header__cart-icon {
    width: 24px;
    height: 24px;
  }

  .header__cart-count {
    position: absolute;
    top: 0;
    right: -2px;
    background-color: var(--color-accent, #00d4aa);
    color: var(--color-bg-dark, #0a0a0a);
    font-size: 0.625rem;
    font-weight: 700;
    line-height: 1;
    min-width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2px;
  }

  .header__cta {
    display: none;
  }

  @media (min-width: 768px) {
    .header__cta {
      display: inline-flex;
    }
  }

  .header__menu-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    color: #ffffff;
    cursor: pointer;
    padding: 0.5rem;
  }

  @media (min-width: 768px) {
    .header__menu-toggle {
      display: none;
    }
  }

  /* Mobile Drawer */
  .header__drawer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    pointer-events: none;
    visibility: hidden;
  }

  .header__drawer.is-open {
    pointer-events: auto;
    visibility: visible;
  }

  .header__drawer-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .header__drawer.is-open .header__drawer-overlay {
    opacity: 1;
  }

  .header__drawer-content {
    position: absolute;
    top: 0;
    right: 0;
    width: 80%;
    max-width: 400px;
    height: 100%;
    background-color: var(--color-bg-card, #141414);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
  }

  .header__drawer.is-open .header__drawer-content {
    transform: translateX(0);
  }

  .header__drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border, rgba(255, 255, 255, 0.1));
  }

  .header__drawer-close {
    background: none;
    border: none;
    color: #ffffff;
    cursor: pointer;
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .header__drawer-nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__drawer-nav-item {
    border-bottom: 1px solid var(--color-border, rgba(255, 255, 255, 0.05));
  }

  .header__drawer-nav-link {
    display: block;
    padding: 1rem 0;
    color: var(--color-text-muted, #b0b0b0);
    text-decoration: none;
    font-size: 1rem;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .header__drawer-nav-link:hover {
    color: #ffffff;
  }

  .header__drawer-cta {
    margin-top: 2rem;
    text-align: center;
    width: 100%;
  }
</style>

<script>
  (function() {
    var section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;

    var toggle = section.querySelector('[data-menu-toggle]');
    var drawer = section.querySelector('[data-mobile-drawer]');
    var overlay = section.querySelector('[data-drawer-overlay]');
    var closeBtn = section.querySelector('[data-drawer-close]');

    function openDrawer() {
      drawer.classList.add('is-open');
      drawer.setAttribute('aria-hidden', 'false');
      toggle.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    }

    function closeDrawer() {
      drawer.classList.remove('is-open');
      drawer.setAttribute('aria-hidden', 'true');
      toggle.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    }

    if (toggle) toggle.addEventListener('click', openDrawer);
    if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
    if (overlay) overlay.addEventListener('click', closeDrawer);
  })();
</script>

{% schema %}
{
  "name": "Header",
  "class": "section-header",
  "tag": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo_image",
      "label": "Logo image"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo text",
      "default": "Chem Connect"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA button text",
      "default": "Join Loyalty Program"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "CTA button link",
      "default": "/account/register"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "label": "Enable sticky header",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "nav_link",
      "name": "Navigation link",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Label"
        },
        {
          "type": "url",
          "id": "url",
          "label": "URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Header",
      "blocks": [
        {
          "type": "nav_link",
          "settings": {
            "label": "How it Works",
            "url": "#how-it-works"
          }
        },
        {
          "type": "nav_link",
          "settings": {
            "label": "Products",
            "url": "#products"
          }
        },
        {
          "type": "nav_link",
          "settings": {
            "label": "My Account",
            "url": "/account"
          }
        }
      ]
    }
  ]
}
{% endschema %}
